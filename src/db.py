# CAMS Software
# Purpose: Database interface code
# Date: Febuary 7, 2023 - February 10, 2023
# CrazyblocksTechnologies Computer Laboratories 2022-2023

import os
import csv
from datetime import date
from sqlalchemy import ForeignKey
currentdate = date.today()
currentdate = currentdate.strftime("%B %d, %Y")

def makeclass(table, col):
    
    with open(col, "r") as f:
        reader = csv.DictReader(f)
        

# May or may not be needed soon 
def checkdb(dbfile):
    if not os.path.isfile(dbfile): 
        return False
    
    size = os.path.getsize(dbfile)

    # file is empty, give benefit of the doubt that its sqlite
    # New sqlite3 files created in recent libraries are empty!
    if size == 0: 
        return True

    # SQLite database file header is 100 bytes
    if size < 100: 
        return False
    
    # Validate file header
    with open(dbfile, 'rb') as fd: 
        header = fd.read(100)    

    return (header[:16] == b'SQLite format 3\x00')

        
def initdb(dbfile):
    
    # This would overwrite the file if it exists
    with open("src/models.py", "w") as f:
        args = {"date": currentdate}
        # File header
        f.write("""# THIS FILE IS AUTOMATICALLY GENERATED - DO NOT EDIT
# CAMS Software
# Purpose: Python class representation of database models
# Generated: {date}
""".format(**args))

        
        f.write(makeclass(tname, colfile))

   
        

        
        
        
        
        
        
